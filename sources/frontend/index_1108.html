<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CogniActive 精準桌球認知教練</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>

    <!-- Import external CSS and JS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='table-tennis.png') }}" type="image/x-icon">
    
    <style></style>
</head>

<body>
    <div class="container">
        <h1>🏓 CogniActive 精準桌球認知教練 🏓</h1>

        <!-- Control Pannel Display -->
        <div class="controls">
            <button id="btnCamera" class="btn-camera" onclick="toggleCamera()">
                開啟鏡頭
            </button>
            <button id="btnRecord" class="btn-record" onclick="startRecording()" disabled>
                開始記錄
            </button>
            <button id="btnStop" class="btn-stop" onclick="stopRecording()" disabled>
                結束記錄
            </button>
        </div>

        <div id="status" class="status" style="display: none;"></div>

        <!-- Heart Rate Display -->
        <div class="heart-rate-container">
            <div id="heartIcon" class="heart-icon">❤️</div>
            <div class="heart-rate-info">
                <div class="heart-rate-label">即時心率監測</div>
                <div id="heartRate" class="heart-rate-value detecting">等待啟動...</div>
            </div>
        </div>

        <!-- Information Cards -->
        <div class="info-grid">
            <div class="info-card">
                <h4>🎯 動作追蹤</h4>
                <p>✓ 33個姿態關鍵點即時偵測</p>
                <p>✓ 3D視角多維度視圖分析</p>
                <p>✓ 關節角度軌跡時序圖表</p>
            </div>
            <div class="info-card">
                <h4>💓 心率偵測</h4>
                <p>✓ rPPG 非接觸式偵測</p>
                <p>✓ 額頭微血管光學偵測</p>
            </div>
        </div>

        <div class="main-content">
            <div class="video-section">
                <h2>📹 2D Video Streaming</h2>            
                <img id="videoFeed" src="" alt="等待鏡頭開啟" style="display: none;"> 
                <div id="videoPlaceholder" style="padding: 100px 0; color: #999;">
                    點擊「開啟鏡頭」開始追蹤
                </div>
            </div>

            <div class="visualization-section">
                <div class="viz-box">
                    <h3>🎭 Front View</h3>
                    <div id="plot3d_view1"></div>
                </div>
                <div class="viz-box">
                    <h3>👤 Side View</h3>
                    <div id="plot3d_view2"></div>
                </div>
            </div>
        </div>

        <div id="performanceMetrics" style="background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <h3 style="margin-top: 0;">Performance Metrics</h3>
            <div class="metric">
                <span class="metric-label">Reaction Time:</span>
                <span class="metric-value">--</span>
            </div>
        </div>

        <div class="chart-section">
            <h2>📊 Action Datapoints</h2>
            <div id="lineChart"></div>
        </div>

        <!-- Technical Information -->
        <div class="info-card" style="margin-top: 20px;">
            <h4>🔬 功能簡介</h4>
            <p><strong>動作偵測：</strong>MediaPipe Pose - 使用深度學習模型進行人體關鍵點檢測</p>
            <p><strong>心率監測：</strong>rPPG (Remote Photoplethysmography) - 透過臉部額頭區域的綠色通道分析微血管血流變化</p>
            <p><strong>信號處理：</strong>Bandpass Filter (0.8-3.0 Hz) + Periodogram 頻譜分析，有效範圍 48-180 BPM</p>
            <p><strong>資料儲存：</strong>Firebase 雲端資料庫即時，支援歷史記錄查詢</p>
        </div>
    </div>
    
    <!-- Import external JS -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>